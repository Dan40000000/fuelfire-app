<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Health Dashboard - FuelFire</title>
    <link rel="stylesheet" href="styles.css">
    <script src="health-sync.js"></script>
</head>
<body>
    <div class="phone-container">
        <div class="screen">
            <!-- Status Bar -->
            <div class="status-bar">
            </div>

            <div class="header">
                <div class="hamburger" onclick="toggleSidebar()">‚ò∞</div>
                <div class="header-title">Health Dashboard</div>
            </div>

            <div class="content">
                <div style="padding: 20px;">

                    <!-- Sync Buttons -->
                    <div style="text-align: center; margin-bottom: 25px;">
                        <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                            <button onclick="syncHealthData()" style="background: var(--gradient-1); color: white; border: none; padding: 15px 30px; border-radius: 25px; font-weight: bold; font-size: 16px; cursor: pointer; box-shadow: 0 4px 15px rgba(75, 156, 211, 0.3);">
                                ‚ôªÔ∏è Sync Apple Health
                            </button>
                            <button onclick="testLogWorkout()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 15px 30px; border-radius: 25px; font-weight: bold; font-size: 16px; cursor: pointer; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);">
                                üí™ Log Test Workout
                            </button>
                        </div>
                        <div id="sync-status" style="margin-top: 10px; font-size: 12px; color: #666;"></div>
                    </div>

                    <!-- Quick Stats Grid -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px;">
                        <!-- Steps -->
                        <div style="background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); color: white; padding: 20px; border-radius: 20px; text-align: center;">
                            <div style="font-size: 36px; margin-bottom: 5px;">üö∂</div>
                            <div style="font-size: 28px; font-weight: bold;" id="steps-count">---</div>
                            <div style="font-size: 13px; opacity: 0.9;">Steps Today</div>
                        </div>

                        <!-- Heart Rate -->
                        <div style="background: linear-gradient(135deg, #E91E63 0%, #C2185B 100%); color: white; padding: 20px; border-radius: 20px; text-align: center;">
                            <div style="font-size: 36px; margin-bottom: 5px;">‚ù§Ô∏è</div>
                            <div style="font-size: 28px; font-weight: bold;" id="heart-rate">--</div>
                            <div style="font-size: 13px; opacity: 0.9;">Heart Rate (bpm)</div>
                        </div>

                        <!-- Calories Burned -->
                        <div style="background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%); color: white; padding: 20px; border-radius: 20px; text-align: center;">
                            <div style="font-size: 36px; margin-bottom: 5px;">üî•</div>
                            <div style="font-size: 28px; font-weight: bold;" id="calories-burned">---</div>
                            <div style="font-size: 13px; opacity: 0.9;">Calories Burned</div>
                        </div>

                        <!-- Distance -->
                        <div style="background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%); color: white; padding: 20px; border-radius: 20px; text-align: center;">
                            <div style="font-size: 36px; margin-bottom: 5px;">üèÉ</div>
                            <div style="font-size: 28px; font-weight: bold;" id="distance">--</div>
                            <div style="font-size: 13px; opacity: 0.9;">Miles</div>
                        </div>
                    </div>

                    <!-- Weight Card -->
                    <div style="background: white; border-radius: 20px; padding: 25px; margin-bottom: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                            <div style="font-size: 40px;">‚öñÔ∏è</div>
                            <div>
                                <div style="font-size: 14px; color: #666;">Current Weight</div>
                                <div style="font-size: 32px; font-weight: bold; color: var(--dark);" id="weight">-- lbs</div>
                            </div>
                        </div>
                    </div>

                    <!-- Today's Workouts -->
                    <div style="background: white; border-radius: 20px; padding: 25px; margin-bottom: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <h3 style="color: var(--primary); margin-bottom: 20px; text-align: center;">üí™ Today's Workouts</h3>
                        <div id="workouts-list" style="color: var(--dark);">
                            <div style="text-align: center; color: #999; padding: 20px;">
                                Sync to see your workouts
                            </div>
                        </div>
                    </div>

                    <!-- Health Summary -->
                    <div style="background: var(--gradient-light); border-radius: 20px; padding: 25px; margin-bottom: 25px;">
                        <h3 style="color: var(--primary); margin-bottom: 15px; text-align: center;">üìä Health Summary</h3>
                        <div style="background: white; border-radius: 15px; padding: 20px; margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <span style="color: #666;">Daily Goal</span>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <span style="font-weight: bold; color: var(--dark);" id="step-goal-display">10,000 steps</span>
                                    <button onclick="editStepGoal()" style="background: var(--gradient-1); color: white; border: none; padding: 5px 12px; border-radius: 12px; font-size: 11px; font-weight: bold; cursor: pointer;">‚úèÔ∏è Edit</button>
                                </div>
                            </div>
                            <div style="background: #e0e0e0; height: 10px; border-radius: 5px; overflow: hidden;">
                                <div id="steps-progress" style="background: var(--gradient-1); height: 100%; width: 0%; transition: width 0.5s;"></div>
                            </div>
                        </div>

                        <div style="background: white; border-radius: 15px; padding: 15px; text-align: center;">
                            <div style="font-size: 14px; color: #666; margin-bottom: 5px;">Last Synced</div>
                            <div id="last-sync" style="font-size: 12px; color: var(--primary); font-weight: bold;">Never</div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Bottom Navigation -->
            <div class="bottom-nav">
                <div class="nav-item" onclick="window.location.href='index.html'">
                    <div class="nav-glow"></div>
                    <div class="nav-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M3 9L12 2L21 9V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V9Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M9 22V12H15V22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="nav-label">Home</div>
                </div>
                <div class="nav-item" onclick="window.location.href='calorie-tracker.html'">
                    <div class="nav-glow"></div>
                    <div class="nav-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2" fill="none"/>
                            <path d="M12 3C12 3 16 8 16 12C16 14.2 14.2 16 12 16C9.8 16 8 14.2 8 12C8 8 12 3 12 3Z" stroke="currentColor" stroke-width="2" fill="none"/>
                        </svg>
                    </div>
                    <div class="nav-label">Food</div>
                </div>
                <div class="nav-item" onclick="window.location.href='health-dashboard.html'">
                    <div class="nav-glow"></div>
                    <div class="nav-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 21.35L10.55 20.03C5.4 15.36 2 12.27 2 8.5C2 5.41 4.42 3 7.5 3C9.24 3 10.91 3.81 12 5.08C13.09 3.81 14.76 3 16.5 3C19.58 3 22 5.41 22 8.5C22 12.27 18.6 15.36 13.45 20.03L12 21.35Z" fill="currentColor"/>
                        </svg>
                    </div>
                    <div class="nav-label">Health</div>
                </div>
                <div class="nav-item" onclick="window.location.href='enhanced-diet-quiz.html'">
                    <div class="nav-glow"></div>
                    <div class="nav-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/>
                            <circle cx="12" cy="12" r="2" fill="currentColor"/>
                            <path d="M12 2V12L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <div class="nav-label">Plan</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Overlay -->
    <div class="overlay" onclick="toggleSidebar()"></div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-brand">üî• FuelFire</div>
        </div>
        <div class="sidebar-menu">
            <div class="menu-item" onclick="window.location.href='index.html'">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                    <path d="M3 9L12 2L21 9V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V9Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M9 22V12H15V22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Home
            </div>
            <div class="menu-item" onclick="window.location.href='index.html#create-workout'">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                    <rect x="2" y="9" width="4" height="6" rx="1" fill="currentColor"/>
                    <rect x="18" y="9" width="4" height="6" rx="1" fill="currentColor"/>
                    <rect x="6" y="11" width="12" height="2" rx="1" fill="currentColor"/>
                    <circle cx="4" cy="12" r="1.5" fill="#fff"/>
                    <circle cx="20" cy="12" r="1.5" fill="#fff"/>
                </svg>
                Create Workout
            </div>
            <div class="menu-item" onclick="window.location.href='index.html#saved-workouts'">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                    <path d="M19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9L11 5H19C19.5304 5 20.0391 5.21071 20.4142 5.58579C20.7893 5.96086 21 6.46957 21 7V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Saved Workouts
            </div>
            <div class="menu-item" onclick="window.location.href='index.html#track-workouts'">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                    <path d="M3 3V18C3 18.5304 3.21071 19.0391 3.58579 19.4142C3.96086 19.7893 4.46957 20 5 20H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M7 14L12 9L16 13L21 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Track Workouts
            </div>
            <div class="menu-item" onclick="window.location.href='calorie-tracker.html'">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                    <path d="M13.5 0.67C13.5 0.67 14.24 3.32 14.24 5.47C14.24 7.53 12.89 9.2 10.83 9.2C8.76 9.2 7.2 7.53 7.2 5.47L7.23 5.1C5.21 7.5 4 10.61 4 14C4 19.5 8.5 24 14 24C19.5 24 24 19.5 24 14C24 8.36 18.37 3.29 13.5 0.67Z" fill="currentColor"/>
                </svg>
                Calorie Tracker
            </div>
            <div class="menu-item active" onclick="window.location.href='health-dashboard.html'">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                    <path d="M12 21.35L10.55 20.03C5.4 15.36 2 12.27 2 8.5C2 5.41 4.42 3 7.5 3C9.24 3 10.91 3.81 12 5.08C13.09 3.81 14.76 3 16.5 3C19.58 3 22 5.41 22 8.5C22 12.27 18.6 15.36 13.45 20.03L12 21.35Z" fill="currentColor"/>
                </svg>
                Health Dashboard
            </div>
            <div class="menu-item" onclick="window.location.href='enhanced-diet-quiz.html'">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/>
                    <circle cx="12" cy="12" r="2" fill="currentColor"/>
                    <path d="M12 2V12L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                Diet Creation
            </div>
            <div class="menu-item" onclick="window.location.href='meal-plans.html'">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                    <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2" fill="none"/>
                    <path d="M12 3C12 3 16 8 16 12C16 14.2 14.2 16 12 16C9.8 16 8 14.2 8 12C8 8 12 3 12 3Z" stroke="currentColor" stroke-width="2" fill="none"/>
                </svg>
                Meal Plans
            </div>
            <div class="menu-item" onclick="window.location.href='meal-ideas.html'">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                    <circle cx="12" cy="12" r="5" stroke="currentColor" stroke-width="2" fill="none"/>
                    <path d="M12 1V3M12 21V23M23 12H21M3 12H1M20.49 3.51L18.36 5.64M5.64 18.36L3.51 20.49M20.49 20.49L18.36 18.36M5.64 5.64L3.51 3.51" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                Meal Ideas
            </div>
            <div class="menu-item" onclick="window.location.href='supplements.html'">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                    <rect x="9" y="2" width="6" height="20" rx="3" stroke="currentColor" stroke-width="2" fill="none"/>
                    <path d="M9 8H15M9 12H15M9 16H15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                Supplements
            </div>
            <div class="menu-item" onclick="window.location.href='workout-techniques.html'">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                    <circle cx="8" cy="8" r="2" fill="currentColor"/>
                    <path d="M8 10V14M8 14L6 20M8 14L10 20M8 14L12 12M12 12L10 6M12 12L14 6M12 12L16 14M16 14L14 20M16 14L18 20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Workout Techniques
            </div>
            <div class="menu-item" onclick="window.location.href='index.html#progress'">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                    <path d="M18 20V10M12 20V4M6 20V14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Goals & Progress
            </div>
        </div>
    </div>

    <script>
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
            document.querySelector('.overlay').classList.toggle('show');
        }

        async function initHealthDashboard() {
            console.log('üè• Initializing Health Dashboard...');

            // Initialize health sync
            const initialized = await window.healthSync.initialize();
            if (!initialized) {
                document.getElementById('sync-status').innerHTML = '‚ö†Ô∏è Health sync not available on this device';
                return;
            }

            // Request permissions
            const permitted = await window.healthSync.requestPermissions();
            if (!permitted) {
                document.getElementById('sync-status').innerHTML = '‚ùå Health permissions denied';
                return;
            }

            // Load cached data if available
            loadCachedData();

            // Auto-sync on load
            setTimeout(syncHealthData, 500);
        }

        function loadCachedData() {
            const cached = localStorage.getItem('healthData');
            if (cached) {
                const data = JSON.parse(cached);
                updateUI(data);
            }
        }

        async function syncHealthData() {
            try {
                document.getElementById('sync-status').innerHTML = 'üîÑ Syncing...';

                // Make sure healthSync is initialized
                if (!window.healthSync) {
                    console.log('üîÑ Initializing health sync...');
                    const initialized = await window.healthSync.initialize();
                    if (!initialized) {
                        document.getElementById('sync-status').innerHTML = '‚ö†Ô∏è Health sync not available';
                        return;
                    }
                }

                const data = await window.healthSync.syncAllData();

                if (!data) {
                    document.getElementById('sync-status').innerHTML = '‚ùå Sync failed - Please grant Health permissions in Settings';
                    return;
                }

                updateUI(data);
                localStorage.setItem('healthData', JSON.stringify(data));
                document.getElementById('sync-status').innerHTML = `‚úÖ Synced at ${new Date().toLocaleTimeString()}`;
            } catch (error) {
                console.error('Sync error:', error);
                document.getElementById('sync-status').innerHTML = `‚ùå Sync failed: ${error.message}`;
            }
        }

        function getStepGoal() {
            return parseInt(localStorage.getItem('stepGoal') || '10000');
        }

        function editStepGoal() {
            const currentGoal = getStepGoal();
            const newGoal = prompt(`Set your daily step goal:`, currentGoal);

            if (newGoal && !isNaN(newGoal) && parseInt(newGoal) > 0) {
                localStorage.setItem('stepGoal', parseInt(newGoal));
                document.getElementById('step-goal-display').textContent = parseInt(newGoal).toLocaleString() + ' steps';

                // Recalculate progress with new goal
                const cached = localStorage.getItem('healthData');
                if (cached) {
                    const data = JSON.parse(cached);
                    updateStepProgress(data.steps);
                }
            }
        }

        function updateStepProgress(steps) {
            const goal = getStepGoal();
            const stepsProgress = Math.min((steps / goal) * 100, 100);
            document.getElementById('steps-progress').style.width = stepsProgress + '%';
        }

        function updateUI(data) {
            // Load custom step goal
            const stepGoal = getStepGoal();
            document.getElementById('step-goal-display').textContent = stepGoal.toLocaleString() + ' steps';

            // Steps
            document.getElementById('steps-count').textContent = data.steps.toLocaleString();
            updateStepProgress(data.steps);

            // Heart Rate
            document.getElementById('heart-rate').textContent = data.heartRate || '--';

            // Calories
            document.getElementById('calories-burned').textContent = data.caloriesBurned.toLocaleString();

            // Distance
            document.getElementById('distance').textContent = data.distance.toFixed(2);

            // Weight
            if (data.weight) {
                document.getElementById('weight').textContent = data.weight.toFixed(1) + ' lbs';
            }

            // Workouts
            updateWorkoutsList(data.workouts);

            // Last sync
            const syncDate = new Date(data.syncTime);
            document.getElementById('last-sync').textContent = syncDate.toLocaleString();
        }

        function updateWorkoutsList(workouts) {
            const container = document.getElementById('workouts-list');

            if (!workouts || workouts.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">No workouts recorded today</div>';
                return;
            }

            let html = '';
            workouts.forEach(workout => {
                const durationMin = Math.round(workout.duration / 60);
                html += `
                    <div style="background: var(--gradient-light); padding: 15px; border-radius: 15px; margin-bottom: 10px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: bold; color: var(--dark); margin-bottom: 5px;">${workout.type}</div>
                                <div style="font-size: 13px; color: #666;">${durationMin} minutes ‚Ä¢ ${Math.round(workout.calories)} calories</div>
                            </div>
                            <div style="font-size: 32px;">üí™</div>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        // Test function to log a workout to Apple Health
        async function testLogWorkout() {
            const workoutType = prompt('What type of workout?\n(e.g., weightlifting, running, cycling, yoga)', 'weightlifting');
            if (!workoutType) return;

            const duration = prompt('How many minutes?', '45');
            if (!duration || isNaN(duration)) return;

            const calories = prompt('Estimated calories burned (optional):', '300');

            document.getElementById('sync-status').innerHTML = 'üí™ Logging workout to Apple Health...';

            const success = await window.logWorkoutToAppleHealth(
                workoutType,
                parseInt(duration),
                calories && !isNaN(calories) ? parseInt(calories) : 0
            );

            if (success) {
                document.getElementById('sync-status').innerHTML = `‚úÖ ${workoutType} workout logged to Apple Health!`;
                // Sync to see the new workout
                setTimeout(syncHealthData, 1000);
            } else {
                document.getElementById('sync-status').innerHTML = '‚ùå Failed to log workout';
            }
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', initHealthDashboard);
    </script>
</body>
</html>
