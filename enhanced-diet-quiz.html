<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Diet Quiz - FuelFire</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="phone-container">
        <div class="screen">
            <div class="status-bar">
                <span id="time">9:41</span>
                <span>100%</span>
            </div>
            
            <div class="header">
                <div class="hamburger" onclick="goBack()">‚Üê</div>
                <div class="header-title">Enhanced Diet Quiz</div>
            </div>
            
            <div class="content">
                <div id="quiz-content">
                    <!-- Quiz content will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced Diet Quiz Variables
        let currentStep = 1;
        const totalSteps = 9;
        let quizData = {};
        let measurementSystem = 'imperial'; // 'imperial' or 'metric'
        
        // Simple inline auth system
        const fuelFireAuth = {
            isLoggedIn: () => localStorage.getItem('fuelfire_demo_user') === 'true',
            demoLogin: () => {
                localStorage.setItem('fuelfire_demo_user', 'true');
                localStorage.setItem('fuelfire_user_name', 'Demo User');
                return { success: true, user: { name: 'Demo User' } };
            },
            getCurrentUser: () => ({ name: localStorage.getItem('fuelfire_user_name') || 'Demo User' })
        };

        // Helper functions for check all/none buttons
        function selectAllMeats() {
            document.querySelectorAll('.meat-check').forEach(cb => cb.checked = true);
        }

        function selectNoMeats() {
            document.querySelectorAll('.meat-check').forEach(cb => cb.checked = false);
        }

        function selectAllVeggies() {
            document.querySelectorAll('.veggie-check').forEach(cb => cb.checked = true);
        }

        function selectNoVeggies() {
            document.querySelectorAll('.veggie-check').forEach(cb => cb.checked = false);
        }

        function handleNoneAllergy(checkbox) {
            if (checkbox.checked) {
                document.querySelectorAll('.allergy-check').forEach(cb => {
                    if (cb !== checkbox) cb.checked = false;
                });
            }
        }

        function toggleMeasurementSystem(system) {
            measurementSystem = system;
            document.getElementById('imperial-btn').style.background = system === 'imperial' ? 'var(--primary)' : 'var(--lighter-bg)';
            document.getElementById('imperial-btn').style.color = system === 'imperial' ? 'white' : 'var(--dark)';
            document.getElementById('metric-btn').style.background = system === 'metric' ? 'var(--primary)' : 'var(--lighter-bg)';
            document.getElementById('metric-btn').style.color = system === 'metric' ? 'white' : 'var(--dark)';
            
            // Toggle height inputs
            document.getElementById('height-imperial').style.display = system === 'imperial' ? 'block' : 'none';
            document.getElementById('height-metric').style.display = system === 'metric' ? 'block' : 'none';
            
            // Update weight label
            document.getElementById('weight-label').textContent = `Weight (${system === 'imperial' ? 'lbs' : 'kg'})`;
            document.getElementById('quiz-weight').placeholder = system === 'imperial' ? '150' : '68';
        }

        function goBack() {
            window.location.href = 'index.html';
        }

        function updateTime() {
            const now = new Date();
            const time = now.toLocaleTimeString('en-US', { 
                hour: 'numeric', 
                minute: '2-digit',
                hour12: true 
            });
            document.getElementById('time').textContent = time;
        }

        function showStep(step) {
            const content = document.getElementById('quiz-content');
            let html = '';

            if (step === 1) {
                html = `
                    <div style="background: var(--gradient-1); color: white; padding: 30px; border-radius: 25px; margin-bottom: 25px; text-align: center;">
                        <h2 style="font-size: 28px; margin-bottom: 10px;">üéØ Your Goals</h2>
                        <p style="opacity: 0.9;">Step 1 of 9 - Let's start with your objectives</p>
                    </div>
                    
                    <div style="background: var(--card-bg); border-radius: 20px; padding: 25px; margin-bottom: 20px;">
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; color: var(--dark); margin-bottom: 8px; font-weight: bold;">What's your primary goal?</label>
                            <select id="diet-goal" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; font-size: 16px;">
                                <option value="">Select your goal...</option>
                                <option value="weight-loss">üî• Weight Loss</option>
                                <option value="muscle-gain">üí™ Muscle Gain</option>
                                <option value="maintenance">‚öñÔ∏è Maintenance</option>
                                <option value="recomp">üîÑ Body Recomposition</option>
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; color: var(--dark); margin-bottom: 8px; font-weight: bold;">Daily calorie target (optional)</label>
                            <input type="number" id="calorie-target" placeholder="Leave blank for automatic calculation" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px;">
                        </div>
                        
                        <button onclick="nextStep()" style="background: var(--gradient-1); color: white; border: none; padding: 15px 30px; border-radius: 25px; width: 100%; font-weight: bold; cursor: pointer; font-size: 18px;">
                            Continue ‚Üí
                        </button>
                    </div>
                `;
            } else if (step === 2) {
                html = `
                    <div style="background: var(--gradient-1); color: white; padding: 30px; border-radius: 25px; margin-bottom: 25px; text-align: center;">
                        <h2 style="font-size: 28px; margin-bottom: 10px;">üë§ Personal Information</h2>
                        <p style="opacity: 0.9;">Step 2 of 9 - Help us understand your needs</p>
                    </div>
                    
                    <div style="background: var(--card-bg); border-radius: 20px; padding: 25px; margin-bottom: 20px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                            <div>
                                <label style="display: block; color: var(--dark); margin-bottom: 8px; font-weight: bold;">Age</label>
                                <input type="number" id="quiz-age" placeholder="25" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px;">
                            </div>
                            <div>
                                <label style="display: block; color: var(--dark); margin-bottom: 8px; font-weight: bold;">Gender</label>
                                <select id="quiz-gender" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px;">
                                    <option value="">Select...</option>
                                    <option value="male">Male</option>
                                    <option value="female">Female</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; color: var(--dark); margin-bottom: 8px; font-weight: bold;">Measurement System</label>
                            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                                <button type="button" id="imperial-btn" onclick="toggleMeasurementSystem('imperial')" style="background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; flex: 1; font-weight: bold;">
                                    üá∫üá∏ Imperial (lb/ft)
                                </button>
                                <button type="button" id="metric-btn" onclick="toggleMeasurementSystem('metric')" style="background: var(--lighter-bg); color: var(--dark); border: 1px solid #ddd; padding: 10px 20px; border-radius: 10px; cursor: pointer; flex: 1; font-weight: bold;">
                                    üåç Metric (kg/cm)
                                </button>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label id="weight-label" style="display: block; color: var(--dark); margin-bottom: 8px; font-weight: bold;">Weight (lbs)</label>
                            <input type="number" id="quiz-weight" placeholder="150" style="width: 100%; padding: 18px; border: 2px solid #ddd; border-radius: 12px; font-size: 18px; font-weight: bold; text-align: center; box-sizing: border-box;">
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; color: var(--dark); margin-bottom: 8px; font-weight: bold;">Height</label>
                            <div id="height-imperial" style="display: block;">
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    <div style="flex: 1;">
                                        <input type="number" id="quiz-feet" placeholder="5" min="3" max="8" style="width: 100%; padding: 18px; border: 2px solid #ddd; border-radius: 12px; font-size: 18px; font-weight: bold; text-align: center; box-sizing: border-box;">
                                        <label style="font-size: 14px; color: #666; margin-top: 4px; display: block; text-align: center; font-weight: bold;">feet</label>
                                    </div>
                                    <div style="flex: 1;">
                                        <input type="number" id="quiz-inches" placeholder="8" min="0" max="11" style="width: 100%; padding: 18px; border: 2px solid #ddd; border-radius: 12px; font-size: 18px; font-weight: bold; text-align: center; box-sizing: border-box;">
                                        <label style="font-size: 14px; color: #666; margin-top: 4px; display: block; text-align: center; font-weight: bold;">inches</label>
                                    </div>
                                </div>
                            </div>
                            <div id="height-metric" style="display: none;">
                                <input type="number" id="quiz-height-cm" placeholder="173" style="width: 100%; padding: 18px; border: 2px solid #ddd; border-radius: 12px; font-size: 18px; font-weight: bold; text-align: center; box-sizing: border-box;">
                                <label style="font-size: 14px; color: #666; margin-top: 4px; display: block; text-align: center; font-weight: bold;">centimeters</label>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; color: var(--dark); margin-bottom: 8px; font-weight: bold;">Activity Level</label>
                            <select id="quiz-activity" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px;">
                                <option value="">Select your activity level...</option>
                                <option value="sedentary">Sedentary (little/no exercise)</option>
                                <option value="light">Light (exercise 1-3 days/week)</option>
                                <option value="moderate">Moderate (exercise 3-5 days/week)</option>
                                <option value="very-active">Very Active (exercise 6-7 days/week)</option>
                                <option value="extra-active">Extra Active (physical job + exercise)</option>
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; color: var(--dark); margin-bottom: 8px; font-weight: bold;">Body Type</label>
                            <select id="quiz-bodytype" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px;">
                                <option value="">Select your body type...</option>
                                <option value="ectomorph">Ectomorph (Naturally thin, fast metabolism)</option>
                                <option value="mesomorph">Mesomorph (Athletic build, gains muscle easily)</option>
                                <option value="endomorph">Endomorph (Stocky build, slower metabolism)</option>
                                <option value="unknown">I DON'T KNOW</option>
                            </select>
                        </div>
                        
                        <div style="display: flex; gap: 10px;">
                            <button onclick="prevStep()" style="background: #e74c3c; color: white; border: none; padding: 15px 30px; border-radius: 25px; flex: 1; font-weight: bold; cursor: pointer;">
                                ‚Üê Back
                            </button>
                            <button onclick="nextStep()" style="background: var(--gradient-1); color: white; border: none; padding: 15px 30px; border-radius: 25px; flex: 2; font-weight: bold; cursor: pointer;">
                                Continue ‚Üí
                            </button>
                        </div>
                    </div>
                `;
            } else if (step === 3) {
                html = `
                    <div style="background: var(--gradient-1); color: white; padding: 30px; border-radius: 25px; margin-bottom: 25px; text-align: center;">
                        <h2 style="font-size: 28px; margin-bottom: 10px;">ü•ó Dietary Restrictions</h2>
                        <p style="opacity: 0.9;">Step 3 of 9 - What should we avoid?</p>
                    </div>
                    
                    <div style="background: var(--card-bg); border-radius: 20px; padding: 25px; margin-bottom: 20px;">
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; color: var(--dark); margin-bottom: 12px; font-weight: bold;">Food Allergies (check all that apply)</label>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; max-height: 250px; overflow-y: auto; border: 1px solid #ddd; padding: 15px; border-radius: 10px;">
                                <label style="background: var(--lighter-bg); padding: 10px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="allergy-check" value="None" style="margin-right: 8px;" onchange="handleNoneAllergy(this)">
                                    <span>None</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 10px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="allergy-check" value="Peanuts" style="margin-right: 8px;">
                                    <span>Peanuts</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 10px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="allergy-check" value="Tree Nuts" style="margin-right: 8px;">
                                    <span>Tree Nuts</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 10px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="allergy-check" value="Dairy" style="margin-right: 8px;">
                                    <span>Dairy</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 10px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="allergy-check" value="Gluten" style="margin-right: 8px;">
                                    <span>Gluten</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 10px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="allergy-check" value="Eggs" style="margin-right: 8px;">
                                    <span>Eggs</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 10px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="allergy-check" value="Shellfish" style="margin-right: 8px;">
                                    <span>Shellfish</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 10px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="allergy-check" value="Fish" style="margin-right: 8px;">
                                    <span>Fish</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 10px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="allergy-check" value="Soy" style="margin-right: 8px;">
                                    <span>Soy</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 10px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="allergy-check" value="Sesame" style="margin-right: 8px;">
                                    <span>Sesame</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 10px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="allergy-check" value="Sulfites" style="margin-right: 8px;">
                                    <span>Sulfites</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 10px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="allergy-check" value="Lactose" style="margin-right: 8px;">
                                    <span>Lactose</span>
                                </label>
                            </div>
                            
                            <div style="margin-top: 15px;">
                                <label style="display: block; color: var(--dark); margin-bottom: 8px; font-weight: bold;">Other Allergies (please specify)</label>
                                <input type="text" id="other-allergies" placeholder="Type any other allergies or food intolerances..." style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px;">
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; color: var(--dark); margin-bottom: 12px; font-weight: bold;">Dietary Lifestyle</label>
                            <select id="quiz-dietary-lifestyle" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px;">
                                <option value="omnivore">Omnivore (eat everything)</option>
                                <option value="vegetarian">Vegetarian (no meat)</option>
                                <option value="vegan">Vegan (no animal products)</option>
                                <option value="pescatarian">Pescatarian (fish only)</option>
                                <option value="keto">Keto (very low carb)</option>
                                <option value="paleo">Paleo (whole foods only)</option>
                            </select>
                        </div>
                        
                        <div style="display: flex; gap: 10px;">
                            <button onclick="prevStep()" style="background: #e74c3c; color: white; border: none; padding: 15px 30px; border-radius: 25px; flex: 1; font-weight: bold; cursor: pointer;">
                                ‚Üê Back
                            </button>
                            <button onclick="nextStep()" style="background: var(--gradient-1); color: white; border: none; padding: 15px 30px; border-radius: 25px; flex: 2; font-weight: bold; cursor: pointer;">
                                Continue ‚Üí
                            </button>
                        </div>
                    </div>
                `;
            } else if (step === 4) {
                html = `
                    <div style="background: var(--gradient-1); color: white; padding: 30px; border-radius: 25px; margin-bottom: 25px; text-align: center;">
                        <h2 style="font-size: 28px; margin-bottom: 10px;">ü•© Meat Preferences</h2>
                        <p style="opacity: 0.9;">Step 4 of 9 - What meats do you enjoy?</p>
                    </div>
                    
                    <div style="background: var(--card-bg); border-radius: 20px; padding: 25px; margin-bottom: 20px;">
                        <div style="margin-bottom: 20px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                <label style="color: var(--dark); font-weight: bold;">Select all meats you enjoy eating</label>
                                <div style="display: flex; gap: 8px;">
                                    <button type="button" onclick="selectAllMeats()" style="background: #28a745; color: white; border: none; padding: 6px 12px; border-radius: 6px; font-size: 12px; cursor: pointer;">
                                        Check All
                                    </button>
                                    <button type="button" onclick="selectNoMeats()" style="background: #dc3545; color: white; border: none; padding: 6px 12px; border-radius: 6px; font-size: 12px; cursor: pointer;">
                                        Check None
                                    </button>
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; max-height: 280px; overflow-y: auto; border: 1px solid #ddd; padding: 15px; border-radius: 10px;">
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="meat-check" value="üêì Chicken Breast" style="margin-right: 8px;">
                                    <span>üêì Chicken Breast</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="meat-check" value="üêì Chicken Thighs" style="margin-right: 8px;">
                                    <span>üêì Chicken Thighs</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="meat-check" value="ü•© Ground Beef" style="margin-right: 8px;">
                                    <span>ü•© Ground Beef</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="meat-check" value="ü•© Steak" style="margin-right: 8px;">
                                    <span>ü•© Steak</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="meat-check" value="ü¶É Turkey" style="margin-right: 8px;">
                                    <span>ü¶É Turkey</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="meat-check" value="üêñ Pork" style="margin-right: 8px;">
                                    <span>üêñ Pork</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="meat-check" value="ü•ì Bacon" style="margin-right: 8px;">
                                    <span>ü•ì Bacon</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="meat-check" value="üå≠ Sausages" style="margin-right: 8px;">
                                    <span>üå≠ Sausages</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="meat-check" value="ü•ö Eggs" style="margin-right: 8px;">
                                    <span>ü•ö Eggs</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="meat-check" value="üêë Lamb" style="margin-right: 8px;">
                                    <span>üêë Lamb</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="meat-check" value="ü¶å Venison" style="margin-right: 8px;">
                                    <span>ü¶å Venison</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="meat-check" value="ü¶Ü Duck" style="margin-right: 8px;">
                                    <span>ü¶Ü Duck</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="meat-check" value="ü•© Lean Ground Beef" style="margin-right: 8px;">
                                    <span>ü•© Lean Ground Beef</span>
                                </label>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; color: var(--dark); margin-bottom: 8px; font-weight: bold;">How often do you want to eat meat?</label>
                            <select id="quiz-meat-frequency" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px;">
                                <option value="every-meal">Every meal</option>
                                <option value="twice-daily">Twice per day</option>
                                <option value="once-daily">Once per day</option>
                                <option value="few-times-week">Few times per week</option>
                                <option value="rarely">Rarely</option>
                                <option value="never">Never (plant-based only)</option>
                            </select>
                        </div>
                        
                        <div style="display: flex; gap: 10px;">
                            <button onclick="prevStep()" style="background: #e74c3c; color: white; border: none; padding: 15px 30px; border-radius: 25px; flex: 1; font-weight: bold; cursor: pointer;">
                                ‚Üê Back
                            </button>
                            <button onclick="nextStep()" style="background: var(--gradient-1); color: white; border: none; padding: 15px 30px; border-radius: 25px; flex: 2; font-weight: bold; cursor: pointer;">
                                Continue ‚Üí
                            </button>
                        </div>
                    </div>
                `;
            } else if (step === 5) {
                html = `
                    <div style="background: var(--gradient-1); color: white; padding: 30px; border-radius: 25px; margin-bottom: 25px; text-align: center;">
                        <h2 style="font-size: 28px; margin-bottom: 10px;">ü•¨ Vegetable Preferences</h2>
                        <p style="opacity: 0.9;">Step 5 of 9 - Choose your vegetables</p>
                    </div>
                    
                    <div style="background: var(--card-bg); border-radius: 20px; padding: 25px; margin-bottom: 20px;">
                        <div style="margin-bottom: 20px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <label style="color: var(--dark); font-weight: bold;">Select vegetables you enjoy</label>
                                <div style="display: flex; gap: 8px;">
                                    <button type="button" onclick="selectAllVeggies()" style="background: #28a745; color: white; border: none; padding: 6px 12px; border-radius: 6px; font-size: 12px; cursor: pointer;">
                                        Check All
                                    </button>
                                    <button type="button" onclick="selectNoVeggies()" style="background: #dc3545; color: white; border: none; padding: 6px 12px; border-radius: 6px; font-size: 12px; cursor: pointer;">
                                        Check None
                                    </button>
                                </div>
                            </div>
                            <p style="font-style: italic; color: #666; margin-bottom: 12px; font-size: 14px;">
                                <em>Recommended: Choose at least 5-8 vegetables for variety</em>
                            </p>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; max-height: 320px; overflow-y: auto; border: 1px solid #ddd; padding: 15px; border-radius: 10px;">
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="veggie-check" value="ü•¨ Spinach" style="margin-right: 8px;" checked>
                                    <span>ü•¨ Spinach</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="veggie-check" value="ü•¶ Broccoli" style="margin-right: 8px;" checked>
                                    <span>ü•¶ Broccoli</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="veggie-check" value="ü•ï Carrots" style="margin-right: 8px;" checked>
                                    <span>ü•ï Carrots</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="veggie-check" value="üçÖ Tomatoes" style="margin-right: 8px;" checked>
                                    <span>üçÖ Tomatoes</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="veggie-check" value="üå∂Ô∏è Bell Peppers" style="margin-right: 8px;" checked>
                                    <span>üå∂Ô∏è Bell Peppers</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="veggie-check" value="ü•í Cucumbers" style="margin-right: 8px;" checked>
                                    <span>ü•í Cucumbers</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="veggie-check" value="üßÖ Onions" style="margin-right: 8px;" checked>
                                    <span>üßÖ Onions</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="veggie-check" value="ü•ë Avocados" style="margin-right: 8px;" checked>
                                    <span>ü•ë Avocados</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="veggie-check" value="ü•¨ Kale" style="margin-right: 8px;" checked>
                                    <span>ü•¨ Kale</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="veggie-check" value="üçÑ Mushrooms" style="margin-right: 8px;" checked>
                                    <span>üçÑ Mushrooms</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="veggie-check" value="üåΩ Corn" style="margin-right: 8px;" checked>
                                    <span>üåΩ Corn</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="veggie-check" value="ü•î Potatoes" style="margin-right: 8px;" checked>
                                    <span>ü•î Potatoes</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="veggie-check" value="üç† Sweet Potatoes" style="margin-right: 8px;" checked>
                                    <span>üç† Sweet Potatoes</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="veggie-check" value="üßÑ Garlic" style="margin-right: 8px;" checked>
                                    <span>üßÑ Garlic</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="veggie-check" value="ü•¨ Lettuce" style="margin-right: 8px;" checked>
                                    <span>ü•¨ Lettuce</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="veggie-check" value="üå∂Ô∏è Jalape√±os" style="margin-right: 8px;" checked>
                                    <span>üå∂Ô∏è Jalape√±os</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="veggie-check" value="ü•í Zucchini" style="margin-right: 8px;" checked>
                                    <span>ü•í Zucchini</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="veggie-check" value="üçÜ Eggplant" style="margin-right: 8px;" checked>
                                    <span>üçÜ Eggplant</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="veggie-check" value="ü•ï Baby Carrots" style="margin-right: 8px;" checked>
                                    <span>ü•ï Baby Carrots</span>
                                </label>
                            </div>
                            <p style="font-style: italic; color: #888; margin-top: 8px; font-size: 12px;">
                                <em>All vegetables are pre-selected. Uncheck any you don't want in your meal plans.</em>
                            </p>
                        </div>
                        
                        <div style="display: flex; gap: 10px;">
                            <button onclick="prevStep()" style="background: #e74c3c; color: white; border: none; padding: 15px 30px; border-radius: 25px; flex: 1; font-weight: bold; cursor: pointer;">
                                ‚Üê Back
                            </button>
                            <button onclick="nextStep()" style="background: var(--gradient-1); color: white; border: none; padding: 15px 30px; border-radius: 25px; flex: 2; font-weight: bold; cursor: pointer;">
                                Continue ‚Üí
                            </button>
                        </div>
                    </div>
                `;
            } else if (step === 6) {
                html = `
                    <div style="background: var(--gradient-1); color: white; padding: 30px; border-radius: 25px; margin-bottom: 25px; text-align: center;">
                        <h2 style="font-size: 28px; margin-bottom: 10px;">üèÉ‚Äç‚ôÇÔ∏è Exercise & Activity</h2>
                        <p style="opacity: 0.9;">Step 6 of 9 - Let's plan your workouts</p>
                    </div>
                    
                    <div style="background: var(--card-bg); border-radius: 20px; padding: 25px; margin-bottom: 20px;">
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; color: var(--dark); margin-bottom: 12px; font-weight: bold;">What types of exercise do you plan to do? (check all that apply)</label>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <label style="background: var(--lighter-bg); padding: 12px; border-radius: 10px; cursor: pointer; display: flex; align-items: center;">
                                    <input type="checkbox" class="exercise-check" value="Weight Training" style="margin-right: 8px;">
                                    <span>üèãÔ∏è Weight Training</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 12px; border-radius: 10px; cursor: pointer; display: flex; align-items: center;">
                                    <input type="checkbox" class="exercise-check" value="Running" style="margin-right: 8px;">
                                    <span>üèÉ Running</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 12px; border-radius: 10px; cursor: pointer; display: flex; align-items: center;">
                                    <input type="checkbox" class="exercise-check" value="Cardio Machines" style="margin-right: 8px;">
                                    <span>üö¥ Cardio Machines</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 12px; border-radius: 10px; cursor: pointer; display: flex; align-items: center;">
                                    <input type="checkbox" class="exercise-check" value="Swimming" style="margin-right: 8px;">
                                    <span>üèä Swimming</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 12px; border-radius: 10px; cursor: pointer; display: flex; align-items: center;">
                                    <input type="checkbox" class="exercise-check" value="Yoga/Pilates" style="margin-right: 8px;">
                                    <span>üßò Yoga/Pilates</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 12px; border-radius: 10px; cursor: pointer; display: flex; align-items: center;">
                                    <input type="checkbox" class="exercise-check" value="Sports" style="margin-right: 8px;">
                                    <span>‚öΩ Sports</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 12px; border-radius: 10px; cursor: pointer; display: flex; align-items: center;">
                                    <input type="checkbox" class="exercise-check" value="Walking/Hiking" style="margin-right: 8px;">
                                    <span>ü•æ Walking/Hiking</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 12px; border-radius: 10px; cursor: pointer; display: flex; align-items: center;">
                                    <input type="checkbox" class="exercise-check" value="HIIT" style="margin-right: 8px;">
                                    <span>üí• HIIT</span>
                                </label>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; color: var(--dark); margin-bottom: 8px; font-weight: bold;">How many days per week do you plan to exercise?</label>
                            <select id="quiz-exercise-days" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px;">
                                <option value="">Select...</option>
                                <option value="1-2">1-2 days per week</option>
                                <option value="3-4">3-4 days per week</option>
                                <option value="5-6">5-6 days per week</option>
                                <option value="7">Every day</option>
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; color: var(--dark); margin-bottom: 8px; font-weight: bold;">Workout intensity level</label>
                            <select id="quiz-intensity" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px;">
                                <option value="light">Light (casual, low intensity)</option>
                                <option value="moderate">Moderate (some challenge, can hold conversation)</option>
                                <option value="vigorous">Vigorous (challenging, breathing hard)</option>
                                <option value="high">High (intense, maximum effort)</option>
                            </select>
                        </div>
                        
                        <div style="display: flex; gap: 10px;">
                            <button onclick="prevStep()" style="background: #e74c3c; color: white; border: none; padding: 15px 30px; border-radius: 25px; flex: 1; font-weight: bold; cursor: pointer;">
                                ‚Üê Back
                            </button>
                            <button onclick="nextStep()" style="background: var(--gradient-1); color: white; border: none; padding: 15px 30px; border-radius: 25px; flex: 2; font-weight: bold; cursor: pointer;">
                                Continue ‚Üí
                            </button>
                        </div>
                    </div>
                `;
            } else if (step === 7) {
                html = `
                    <div style="background: var(--gradient-1); color: white; padding: 30px; border-radius: 25px; margin-bottom: 25px; text-align: center;">
                        <h2 style="font-size: 28px; margin-bottom: 10px;">üçΩÔ∏è Meal Preferences</h2>
                        <p style="opacity: 0.9;">Step 7 of 9 - How do you like to eat?</p>
                    </div>
                    
                    <div style="background: var(--card-bg); border-radius: 20px; padding: 25px; margin-bottom: 20px;">
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; color: var(--dark); margin-bottom: 8px; font-weight: bold;">How many meals per day do you prefer?</label>
                            <select id="quiz-meals-per-day" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px;">
                                <option value="3">3 meals (breakfast, lunch, dinner)</option>
                                <option value="4">4 meals (3 meals + 1 snack)</option>
                                <option value="5">5 meals (3 meals + 2 snacks)</option>
                                <option value="6">6 small meals throughout the day</option>
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; color: var(--dark); margin-bottom: 8px; font-weight: bold;">Cooking experience level</label>
                            <select id="quiz-cooking-level" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px;">
                                <option value="beginner">Beginner (prefer simple recipes)</option>
                                <option value="intermediate">Intermediate (comfortable with most recipes)</option>
                                <option value="advanced">Advanced (enjoy complex cooking)</option>
                                <option value="minimal">Minimal (prefer meal prep/quick meals)</option>
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; color: var(--dark); margin-bottom: 8px; font-weight: bold;">How much time do you want to spend cooking daily?</label>
                            <select id="quiz-cooking-time" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px;">
                                <option value="15-min">15 minutes or less</option>
                                <option value="30-min">30 minutes</option>
                                <option value="45-min">45 minutes</option>
                                <option value="60-min">1 hour</option>
                                <option value="more">More than 1 hour</option>
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; color: var(--dark); margin-bottom: 12px; font-weight: bold;">Meal prep preferences (check all that apply)</label>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <label style="background: var(--lighter-bg); padding: 12px; border-radius: 10px; cursor: pointer; display: flex; align-items: center;">
                                    <input type="checkbox" class="meal-prep-check" value="Batch cooking" style="margin-right: 8px;">
                                    <span>üì¶ Batch cooking</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 12px; border-radius: 10px; cursor: pointer; display: flex; align-items: center;">
                                    <input type="checkbox" class="meal-prep-check" value="Make-ahead meals" style="margin-right: 8px;">
                                    <span>‚è∞ Make-ahead meals</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 12px; border-radius: 10px; cursor: pointer; display: flex; align-items: center;">
                                    <input type="checkbox" class="meal-prep-check" value="Fresh daily cooking" style="margin-right: 8px;">
                                    <span>üî• Fresh daily cooking</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 12px; border-radius: 10px; cursor: pointer; display: flex; align-items: center;">
                                    <input type="checkbox" class="meal-prep-check" value="One-pot meals" style="margin-right: 8px;">
                                    <span>üç≤ One-pot meals</span>
                                </label>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 10px;">
                            <button onclick="prevStep()" style="background: #e74c3c; color: white; border: none; padding: 15px 30px; border-radius: 25px; flex: 1; font-weight: bold; cursor: pointer;">
                                ‚Üê Back
                            </button>
                            <button onclick="nextStep()" style="background: var(--gradient-1); color: white; border: none; padding: 15px 30px; border-radius: 25px; flex: 2; font-weight: bold; cursor: pointer;">
                                Continue ‚Üí
                            </button>
                        </div>
                    </div>
                `;
            } else if (step === 8) {
                html = `
                    <div style="background: var(--gradient-1); color: white; padding: 30px; border-radius: 25px; margin-bottom: 25px; text-align: center;">
                        <h2 style="font-size: 28px; margin-bottom: 10px;">üéØ Final Details</h2>
                        <p style="opacity: 0.9;">Step 8 of 9 - Almost done!</p>
                    </div>
                    
                    <div style="background: var(--card-bg); border-radius: 20px; padding: 25px; margin-bottom: 20px;">
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; color: var(--dark); margin-bottom: 8px; font-weight: bold;">Budget for groceries per week</label>
                            <select id="quiz-budget" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px;">
                                <option value="low">$50-75 per week (budget-friendly)</option>
                                <option value="moderate">$75-125 per week (moderate)</option>
                                <option value="high">$125-200 per week (premium)</option>
                                <option value="unlimited">$200+ per week (no budget constraints)</option>
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; color: var(--dark); margin-bottom: 12px; font-weight: bold;">Food preferences & cuisines you enjoy (check all that apply)</label>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; max-height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 15px; border-radius: 10px;">
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="cuisine-check" value="American" style="margin-right: 8px;">
                                    <span>üá∫üá∏ American</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="cuisine-check" value="Italian" style="margin-right: 8px;">
                                    <span>üáÆüáπ Italian</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="cuisine-check" value="Mexican" style="margin-right: 8px;">
                                    <span>üá≤üáΩ Mexican</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="cuisine-check" value="Asian" style="margin-right: 8px;">
                                    <span>ü•¢ Asian</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="cuisine-check" value="Mediterranean" style="margin-right: 8px;">
                                    <span>ü´í Mediterranean</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="cuisine-check" value="Indian" style="margin-right: 8px;">
                                    <span>üáÆüá≥ Indian</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="cuisine-check" value="Thai" style="margin-right: 8px;">
                                    <span>üáπüá≠ Thai</span>
                                </label>
                                <label style="background: var(--lighter-bg); padding: 8px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; font-size: 13px;">
                                    <input type="checkbox" class="cuisine-check" value="Greek" style="margin-right: 8px;">
                                    <span>üá¨üá∑ Greek</span>
                                </label>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; color: var(--dark); margin-bottom: 8px; font-weight: bold;">Any additional notes or special requests?</label>
                            <textarea id="quiz-notes" placeholder="Anything else we should know about your diet preferences, schedule, or goals..." style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; resize: vertical; min-height: 80px;"></textarea>
                        </div>
                        
                        <div style="display: flex; gap: 10px;">
                            <button onclick="prevStep()" style="background: #e74c3c; color: white; border: none; padding: 15px 30px; border-radius: 25px; flex: 1; font-weight: bold; cursor: pointer;">
                                ‚Üê Back
                            </button>
                            <button onclick="nextStep()" style="background: var(--gradient-1); color: white; border: none; padding: 15px 30px; border-radius: 25px; flex: 2; font-weight: bold; cursor: pointer;">
                                Continue ‚Üí
                            </button>
                        </div>
                    </div>
                `;
            } else if (step === 9) {
                html = `
                    <div style="background: var(--gradient-1); color: white; padding: 30px; border-radius: 25px; margin-bottom: 25px; text-align: center;">
                        <h2 style="font-size: 28px; margin-bottom: 10px;">üéØ Quiz Complete!</h2>
                        <p style="opacity: 0.9;">Step 9 of 9 - Ready to generate your plan</p>
                    </div>
                    
                    <div style="background: var(--card-bg); border-radius: 20px; padding: 25px; margin-bottom: 20px; text-align: center;">
                        <h3 style="color: var(--dark); margin-bottom: 20px;">üéâ Your Enhanced Diet Quiz is Complete!</h3>
                        <p style="color: #666; margin-bottom: 25px;">We've collected all your preferences and will generate a personalized 2-week meal plan with shopping lists.</p>
                        
                        <button onclick="generatePlan()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 20px 40px; border-radius: 25px; font-weight: bold; cursor: pointer; font-size: 18px; margin-bottom: 15px;">
                            üöÄ Generate My AI Meal Plan
                        </button>
                        
                        <div style="margin-top: 20px;">
                            <button onclick="goBack()" style="background: #6c757d; color: white; border: none; padding: 12px 25px; border-radius: 20px; cursor: pointer;">
                                ‚Üê Back to Main App
                            </button>
                        </div>
                    </div>
                `;
            } else {
                html = `
                    <div style="background: var(--gradient-1); color: white; padding: 30px; border-radius: 25px; margin-bottom: 25px; text-align: center;">
                        <h2 style="font-size: 28px; margin-bottom: 10px;">üöß Step ${step}</h2>
                        <p style="opacity: 0.9;">Step ${step} of 9 - Coming soon!</p>
                    </div>
                    
                    <div style="background: var(--card-bg); border-radius: 20px; padding: 25px; margin-bottom: 20px; text-align: center;">
                        <p style="color: #666; margin-bottom: 25px;">This step is still being built. You can see steps 1-5 and 9 are working!</p>
                        
                        <div style="display: flex; gap: 10px;">
                            <button onclick="prevStep()" style="background: #e74c3c; color: white; border: none; padding: 15px 30px; border-radius: 25px; flex: 1; font-weight: bold; cursor: pointer;">
                                ‚Üê Back
                            </button>
                            <button onclick="nextStep()" style="background: var(--gradient-1); color: white; border: none; padding: 15px 30px; border-radius: 25px; flex: 2; font-weight: bold; cursor: pointer;">
                                Skip ‚Üí
                            </button>
                        </div>
                    </div>
                `;
            }

            content.innerHTML = html;
        }

        function nextStep() {
            // Save current step data
            if (currentStep === 1) {
                quizData.goal = document.getElementById('diet-goal').value;
                quizData.calories = document.getElementById('calorie-target').value;
                
                if (!quizData.goal) {
                    alert('Please select your goal');
                    return;
                }
            } else if (currentStep === 2) {
                quizData.age = document.getElementById('quiz-age').value;
                quizData.gender = document.getElementById('quiz-gender').value;
                quizData.weight = document.getElementById('quiz-weight').value;
                quizData.activity = document.getElementById('quiz-activity').value;
                quizData.bodyType = document.getElementById('quiz-bodytype').value;
                quizData.measurementSystem = measurementSystem;
                if (measurementSystem === 'metric') {
                    quizData.heightCm = document.getElementById('quiz-height-cm').value;
                } else {
                    quizData.feet = document.getElementById('quiz-feet').value;
                    quizData.inches = document.getElementById('quiz-inches').value;
                }
            } else if (currentStep === 3) {
                quizData.allergies = Array.from(document.querySelectorAll('.allergy-check:checked')).map(cb => cb.value);
                quizData.dietaryLifestyle = document.getElementById('quiz-dietary-lifestyle').value;
                quizData.otherAllergies = document.getElementById('other-allergies').value;
            } else if (currentStep === 4) {
                quizData.meats = Array.from(document.querySelectorAll('.meat-check:checked')).map(cb => cb.value);
                quizData.meatFrequency = document.getElementById('quiz-meat-frequency').value;
            } else if (currentStep === 5) {
                quizData.vegetables = Array.from(document.querySelectorAll('.veggie-check:checked')).map(cb => cb.value);
            } else if (currentStep === 6) {
                quizData.exerciseTypes = Array.from(document.querySelectorAll('.exercise-check:checked')).map(cb => cb.value);
                quizData.exerciseDays = document.getElementById('quiz-exercise-days').value;
                quizData.exerciseIntensity = document.getElementById('quiz-intensity').value;
            } else if (currentStep === 7) {
                quizData.mealsPerDay = document.getElementById('quiz-meals-per-day').value;
                quizData.cookingLevel = document.getElementById('quiz-cooking-level').value;
                quizData.cookingTime = document.getElementById('quiz-cooking-time').value;
                quizData.mealPrepPrefs = Array.from(document.querySelectorAll('.meal-prep-check:checked')).map(cb => cb.value);
            } else if (currentStep === 8) {
                quizData.budget = document.getElementById('quiz-budget').value;
                quizData.cuisines = Array.from(document.querySelectorAll('.cuisine-check:checked')).map(cb => cb.value);
                quizData.notes = document.getElementById('quiz-notes').value;
            }
            
            if (currentStep < totalSteps) {
                currentStep++;
                showStep(currentStep);
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
            }
        }

        async function generatePlan() {
            // Check if user is authenticated
            if (!fuelFireAuth.isLoggedIn()) {
                if (confirm('üîê You need to be logged in to generate AI meal plans. Would you like to continue with a demo account?')) {
                    const loginResult = fuelFireAuth.demoLogin();
                    if (!loginResult.success) {
                        alert('‚ùå Failed to create demo account. Please try again.');
                        return;
                    }
                    alert(`‚úÖ Logged in as ${loginResult.user.name}! Now generating your meal plan...`);
                } else {
                    return;
                }
            }

            // Show loading state
            const button = document.querySelector('button[onclick="generatePlan()"]') || event?.target;
            const originalText = button.innerHTML;
            button.innerHTML = '‚è≥ Generating Your Personalized Meal Plan...';
            button.disabled = true;
            
            try {
                // Prepare the comprehensive prompt for Claude AI
                const prompt = createMealPlanPrompt(quizData);
                
                // For demo purposes, we'll simulate the API call with a realistic meal plan
                // In production, this would call the actual Claude API
                const mealPlan = await simulateClaudeAPI(prompt);
                
                // Display the generated meal plan
                displayMealPlan(mealPlan);
                
                // Reset button
                button.innerHTML = originalText;
                button.disabled = false;
                
            } catch (error) {
                console.error('Error generating meal plan:', error);
                alert('‚ùå Sorry, there was an error generating your meal plan. Please try again.');
                button.innerHTML = originalText;
                button.disabled = false;
            }
        }
        
        function createMealPlanPrompt(data) {
            return `You are a professional nutritionist and meal planning expert. Create a detailed 2-week personalized meal plan based on the following user preferences and data:

**USER PROFILE:**
- Goal: ${data.goal || 'Not specified'}
- Age: ${data.age || 'Not specified'}
- Gender: ${data.gender || 'Not specified'}
- Weight: ${data.weight || 'Not specified'} ${data.measurementSystem === 'metric' ? 'kg' : 'lbs'}
- Height: ${data.measurementSystem === 'metric' ? (data.heightCm + ' cm') : (data.feet + "'" + data.inches + '"')}
- Activity Level: ${data.activity || 'Not specified'}
- Body Type: ${data.bodyType || 'Not specified'}
- Target Calories: ${data.calories || 'Calculate automatically'}

**DIETARY RESTRICTIONS:**
- Food Allergies: ${data.allergies ? data.allergies.join(', ') : 'None'}
- Other Allergies: ${data.otherAllergies || 'None'}
- Dietary Lifestyle: ${data.dietaryLifestyle || 'Omnivore'}

**FOOD PREFERENCES:**
- Preferred Meats: ${data.meats ? data.meats.join(', ') : 'All'}
- Meat Frequency: ${data.meatFrequency || 'Not specified'}
- Preferred Vegetables: ${data.vegetables ? data.vegetables.join(', ') : 'All'}

**EXERCISE & LIFESTYLE:**
- Exercise Types: ${data.exerciseTypes ? data.exerciseTypes.join(', ') : 'Not specified'}
- Exercise Days per Week: ${data.exerciseDays || 'Not specified'}
- Exercise Intensity: ${data.exerciseIntensity || 'Not specified'}

**MEAL PREFERENCES:**
- Meals per Day: ${data.mealsPerDay || '3'}
- Cooking Level: ${data.cookingLevel || 'Intermediate'}
- Cooking Time: ${data.cookingTime || '30 minutes'}
- Meal Prep Preferences: ${data.mealPrepPrefs ? data.mealPrepPrefs.join(', ') : 'Fresh daily cooking'}

**BUDGET & CUISINE:**
- Weekly Budget: ${data.budget || 'Moderate'}
- Preferred Cuisines: ${data.cuisines ? data.cuisines.join(', ') : 'All'}

**ADDITIONAL NOTES:**
${data.notes || 'None'}

**REQUIREMENTS:**
1. Create a complete 2-week meal plan (14 days) with exact measurements for all ingredients (e.g., "4 oz chicken breast", "1 cup quinoa", "2 tbsp olive oil")
2. Include breakfast, lunch, dinner, and snacks if requested
3. Provide detailed nutritional information (calories, protein, carbs, fat) for each meal
4. Calculate daily totals that align with their goals
5. Create comprehensive shopping lists for Week 1 and Week 2 with exact quantities needed
6. Group shopping list items by category (proteins, vegetables, fruits, grains, dairy, etc.)
7. Include cooking instructions and prep tips
8. Ensure variety and balance throughout the 2 weeks
9. Respect all dietary restrictions and preferences
10. Format everything clearly and professionally

Please provide the response in a structured format with clear sections for:
- Daily Meal Plans (Day 1-14)
- Week 1 Shopping List
- Week 2 Shopping List
- Nutritional Summary
- Meal Prep Tips`;
        }
        
        async function simulateClaudeAPI(prompt) {
            // Simulate API delay
            await new Promise(resolve => setTimeout(resolve, 3000));
            
            // Generate a realistic meal plan based on user data
            return generateRealisticMealPlan(quizData);
        }
        
        async function callClaudeAPI(prompt) {
            // Real implementation for production use
            const response = await fetch('/api/generate-meal-plan', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer demo-token'
                },
                body: JSON.stringify({
                    prompt: prompt,
                    userToken: 'demo-user'
                })
            });
            
            if (!response.ok) {
                throw new Error('Failed to generate meal plan');
            }
            
            const result = await response.json();
            return result.mealPlan;
        }
        
        function generateRealisticMealPlan(data) {
            const goal = data.goal || 'maintenance';
            const calories = data.calories || (goal === 'weight-loss' ? 1800 : goal === 'muscle-gain' ? 2400 : 2000);
            const meats = data.meats || ['üêì Chicken Breast', 'ü•© Ground Beef', 'ü¶É Turkey'];
            const vegetables = data.vegetables || ['ü•¨ Spinach', 'ü•¶ Broccoli', 'ü•ï Carrots'];
            
            return `
            <div class="section">
                <h2 class="section-header">üìä Your Personalized Plan Overview</h2>
                <div class="nutrition">
                    <strong>Daily Target:</strong> ${calories} calories<br>
                    <strong>Goal:</strong> ${goal.replace('-', ' ').toUpperCase()}<br>
                    <strong>Protein:</strong> ${Math.round(calories * 0.3 / 4)}g | <strong>Carbs:</strong> ${Math.round(calories * 0.4 / 4)}g | <strong>Fat:</strong> ${Math.round(calories * 0.3 / 9)}g
                </div>
            </div>

            <div class="section">
                <h2 class="section-header">üìÖ Week 1 Meal Plan</h2>
                
                <div class="day">
                    <h3 class="day-header">Day 1</h3>
                    <div class="meal">
                        <strong>Breakfast:</strong> Greek Yogurt Power Bowl<br>
                        ‚Ä¢ 1 cup Greek yogurt (0% fat)<br>
                        ‚Ä¢ 1/2 cup blueberries<br>
                        ‚Ä¢ 2 tbsp granola<br>
                        ‚Ä¢ 1 tbsp honey<br>
                        <div class="nutrition">Calories: 320 | Protein: 20g | Carbs: 45g | Fat: 8g</div>
                    </div>
                    <div class="meal">
                        <strong>Lunch:</strong> Grilled Chicken Salad<br>
                        ‚Ä¢ 5 oz grilled chicken breast<br>
                        ‚Ä¢ 2 cups mixed greens<br>
                        ‚Ä¢ 1/2 cup cherry tomatoes<br>
                        ‚Ä¢ 1/4 avocado<br>
                        ‚Ä¢ 2 tbsp olive oil vinaigrette<br>
                        <div class="nutrition">Calories: 485 | Protein: 42g | Carbs: 12g | Fat: 28g</div>
                    </div>
                    <div class="meal">
                        <strong>Dinner:</strong> Baked Salmon with Roasted Vegetables<br>
                        ‚Ä¢ 6 oz Atlantic salmon fillet<br>
                        ‚Ä¢ 1 cup roasted broccoli<br>
                        ‚Ä¢ 1 medium roasted sweet potato<br>
                        ‚Ä¢ 1 tbsp olive oil<br>
                        <div class="nutrition">Calories: 520 | Protein: 35g | Carbs: 35g | Fat: 25g</div>
                    </div>
                    <div class="meal">
                        <strong>Snack:</strong> Apple with Almond Butter<br>
                        ‚Ä¢ 1 medium apple<br>
                        ‚Ä¢ 2 tbsp natural almond butter<br>
                        <div class="nutrition">Calories: 275 | Protein: 8g | Carbs: 25g | Fat: 16g</div>
                    </div>
                    <div class="nutrition"><strong>Daily Total: ${calories} calories | Protein: 105g | Carbs: 117g | Fat: 77g</strong></div>
                </div>

                <div class="day">
                    <h3 class="day-header">Day 2</h3>
                    <div class="meal">
                        <strong>Breakfast:</strong> Protein Smoothie<br>
                        ‚Ä¢ 1 scoop whey protein powder<br>
                        ‚Ä¢ 1 cup unsweetened almond milk<br>
                        ‚Ä¢ 1/2 banana<br>
                        ‚Ä¢ 1 cup spinach<br>
                        ‚Ä¢ 1 tbsp chia seeds<br>
                        <div class="nutrition">Calories: 285 | Protein: 28g | Carbs: 20g | Fat: 8g</div>
                    </div>
                    <div class="meal">
                        <strong>Lunch:</strong> Turkey and Quinoa Bowl<br>
                        ‚Ä¢ 4 oz lean ground turkey (cooked)<br>
                        ‚Ä¢ 1/2 cup cooked quinoa<br>
                        ‚Ä¢ 1/2 cup black beans<br>
                        ‚Ä¢ 1/4 cup corn<br>
                        ‚Ä¢ 2 tbsp salsa<br>
                        <div class="nutrition">Calories: 465 | Protein: 38g | Carbs: 45g | Fat: 12g</div>
                    </div>
                    <div class="meal">
                        <strong>Dinner:</strong> Lean Beef Stir-Fry<br>
                        ‚Ä¢ 5 oz lean sirloin steak (strips)<br>
                        ‚Ä¢ 1.5 cups mixed stir-fry vegetables<br>
                        ‚Ä¢ 1/2 cup brown rice<br>
                        ‚Ä¢ 1 tbsp sesame oil<br>
                        <div class="nutrition">Calories: 545 | Protein: 40g | Carbs: 38g | Fat: 22g</div>
                    </div>
                    <div class="meal">
                        <strong>Snack:</strong> Greek Yogurt with Berries<br>
                        ‚Ä¢ 3/4 cup Greek yogurt<br>
                        ‚Ä¢ 1/2 cup mixed berries<br>
                        <div class="nutrition">Calories: 185 | Protein: 15g | Carbs: 18g | Fat: 3g</div>
                    </div>
                    <div class="nutrition"><strong>Daily Total: ${calories} calories | Protein: 121g | Carbs: 121g | Fat: 45g</strong></div>
                </div>

                <!-- Additional days would follow the same pattern -->
                <p><em>Days 3-7 continue with similar variety and balance...</em></p>
            </div>

            <div class="section">
                <h2 class="section-header">üõí Week 1 Shopping List</h2>
                <div class="shopping-list">
                    <div class="category">ü•© PROTEINS</div>
                    ‚Ä¢ Chicken breast - 2.5 lbs<br>
                    ‚Ä¢ Atlantic salmon fillets - 1.5 lbs<br>
                    ‚Ä¢ Lean ground turkey - 1 lb<br>
                    ‚Ä¢ Lean sirloin steak - 1.25 lbs<br>
                    ‚Ä¢ Greek yogurt (0% fat) - 2 large containers (32oz each)<br>
                    ‚Ä¢ Whey protein powder - 1 container<br>
                    ‚Ä¢ Eggs - 1 dozen<br>

                    <div class="category">ü•¨ VEGETABLES</div>
                    ‚Ä¢ Mixed greens - 2 bags (5oz each)<br>
                    ‚Ä¢ Spinach - 2 bags (6oz each)<br>
                    ‚Ä¢ Broccoli - 2 lbs<br>
                    ‚Ä¢ Cherry tomatoes - 1 pint<br>
                    ‚Ä¢ Mixed stir-fry vegetables - 2 bags (12oz each)<br>
                    ‚Ä¢ Sweet potatoes - 4 medium<br>

                    <div class="category">üçé FRUITS</div>
                    ‚Ä¢ Blueberries - 1 pint<br>
                    ‚Ä¢ Bananas - 6 medium<br>
                    ‚Ä¢ Apples - 4 medium<br>
                    ‚Ä¢ Mixed berries - 2 cups<br>

                    <div class="category">üåæ GRAINS & PANTRY</div>
                    ‚Ä¢ Quinoa - 1 bag (2 lbs)<br>
                    ‚Ä¢ Brown rice - 1 bag (2 lbs)<br>
                    ‚Ä¢ Granola - 1 bag<br>
                    ‚Ä¢ Black beans - 2 cans (15oz each)<br>
                    ‚Ä¢ Corn kernels - 1 can<br>

                    <div class="category">ü•ë HEALTHY FATS</div>
                    ‚Ä¢ Avocados - 3 medium<br>
                    ‚Ä¢ Natural almond butter - 1 jar<br>
                    ‚Ä¢ Olive oil - 1 bottle<br>
                    ‚Ä¢ Sesame oil - 1 small bottle<br>
                    ‚Ä¢ Chia seeds - 1 bag<br>

                    <div class="category">ü•õ DAIRY & ALTERNATIVES</div>
                    ‚Ä¢ Unsweetened almond milk - 1 carton (64oz)<br>
                    ‚Ä¢ Honey - 1 jar<br>
                    ‚Ä¢ Olive oil vinaigrette - 1 bottle<br>
                    ‚Ä¢ Salsa - 1 jar<br>
                </div>
                <div class="nutrition"><strong>Estimated Cost: $75-95 for Week 1</strong></div>
            </div>

            <div class="section">
                <h2 class="section-header">üìÖ Week 2 Meal Plan</h2>
                <p><em>Week 2 introduces new recipes with similar nutritional balance, featuring different protein sources and cooking methods to keep your meals exciting...</em></p>
                
                <div class="day">
                    <h3 class="day-header">Day 8 Sample</h3>
                    <div class="meal">
                        <strong>Breakfast:</strong> Scrambled Eggs with Vegetables<br>
                        ‚Ä¢ 3 large eggs<br>
                        ‚Ä¢ 1/2 cup bell peppers<br>
                        ‚Ä¢ 1/4 cup onions<br>
                        ‚Ä¢ 1 slice whole grain toast<br>
                        ‚Ä¢ 1 tsp olive oil<br>
                        <div class="nutrition">Calories: 340 | Protein: 22g | Carbs: 18g | Fat: 20g</div>
                    </div>
                    <!-- More meals would be detailed here -->
                </div>
            </div>

            <div class="section">
                <h2 class="section-header">üõí Week 2 Shopping List</h2>
                <div class="shopping-list">
                    <div class="category">ü•© PROTEINS</div>
                    ‚Ä¢ White fish fillets (cod/tilapia) - 1.5 lbs<br>
                    ‚Ä¢ Chicken thighs - 2 lbs<br>
                    ‚Ä¢ Lean pork tenderloin - 1 lb<br>
                    ‚Ä¢ Additional eggs - 1 dozen<br>

                    <div class="category">ü•¨ VEGETABLES</div>
                    ‚Ä¢ Bell peppers - 4 medium<br>
                    ‚Ä¢ Zucchini - 3 medium<br>
                    ‚Ä¢ Cauliflower - 1 head<br>
                    ‚Ä¢ Green beans - 1 lb<br>

                    <!-- Continue with other categories -->
                </div>
                <div class="nutrition"><strong>Estimated Cost: $70-90 for Week 2</strong></div>
            </div>

            <div class="section">
                <h2 class="section-header">üí° Meal Prep Tips</h2>
                <div class="meal">
                    <strong>Sunday Prep (2 hours):</strong><br>
                    ‚Ä¢ Cook quinoa and brown rice in bulk<br>
                    ‚Ä¢ Grill all chicken breasts for the week<br>
                    ‚Ä¢ Wash and chop vegetables<br>
                    ‚Ä¢ Prepare overnight oats or smoothie packs<br><br>

                    <strong>Mid-Week Prep (30 minutes):</strong><br>
                    ‚Ä¢ Prepare fresh fish/seafood dishes<br>
                    ‚Ä¢ Refresh salad ingredients<br>
                    ‚Ä¢ Prep snack portions<br><br>

                    <strong>Storage Tips:</strong><br>
                    ‚Ä¢ Store proteins in airtight containers (3-4 days max)<br>
                    ‚Ä¢ Keep cut vegetables in glass containers<br>
                    ‚Ä¢ Freeze smoothie packs for easy morning prep<br>
                    ‚Ä¢ Portion nuts and seeds in small containers
                </div>
            </div>

            <div class="section">
                <h2 class="section-header">üéØ Success Tips</h2>
                <div class="nutrition">
                    ‚Ä¢ <strong>Hydration:</strong> Drink 8-10 glasses of water daily<br>
                    ‚Ä¢ <strong>Timing:</strong> Eat every 3-4 hours to maintain energy<br>
                    ‚Ä¢ <strong>Flexibility:</strong> Swap similar foods if needed (chicken ‚Üî turkey, broccoli ‚Üî green beans)<br>
                    ‚Ä¢ <strong>Progress:</strong> Track your meals and how you feel<br>
                    ‚Ä¢ <strong>Preparation:</strong> Success comes from planning ahead!
                </div>
            </div>
            `;
        }
        
        function getUserToken() {
            // Get user authentication token from localStorage or session
            return localStorage.getItem('userToken') || 'demo-user';
        }
        
        function displayMealPlan(mealPlan) {
            // Create a new page/modal to display the comprehensive meal plan
            const mealPlanWindow = window.open('', '_blank', 'width=1000,height=800,scrollbars=yes');
            
            const htmlContent = `
<!DOCTYPE html>
<html>
<head>
    <title>Your Personalized 2-Week Meal Plan</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; text-align: center; margin-bottom: 30px; }
        .section { margin-bottom: 30px; padding: 20px; border: 1px solid #ddd; border-radius: 10px; }
        .day { background: #f8f9fa; padding: 15px; margin-bottom: 15px; border-radius: 8px; }
        .meal { margin-bottom: 10px; padding: 10px; background: white; border-left: 4px solid #667eea; }
        .shopping-list { background: #e8f4f8; padding: 15px; border-radius: 8px; }
        .category { font-weight: bold; color: #667eea; margin-top: 15px; margin-bottom: 8px; }
        .print-btn { background: #667eea; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 10px 5px; }
        .nutrition { background: #f0f8ff; padding: 10px; border-radius: 5px; margin-top: 10px; }
        .section-header { color: #667eea; border-bottom: 2px solid #667eea; padding-bottom: 10px; }
        .day-header { color: #333; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üéØ Your Personalized 2-Week Meal Plan</h1>
        <p>Generated specifically for your goals and preferences</p>
    </div>
    
    <div style="text-align: center; margin-bottom: 20px;">
        <button class="print-btn" onclick="window.print()">üñ®Ô∏è Print Meal Plan</button>
        <button class="print-btn" onclick="downloadPDF()">üìÑ Download PDF</button>
        <button class="print-btn" onclick="window.close()">‚ùå Close</button>
    </div>
    
    <div id="meal-plan-content">
        ${mealPlan}
    </div>
    
    <script>
        function downloadPDF() {
            alert('PDF download feature coming soon!');
        }
    </script>
</body>
</html>
            `;
            
            mealPlanWindow.document.write(htmlContent);
            mealPlanWindow.document.close();
        }

        // Initialize
        updateTime();
        setInterval(updateTime, 1000);
        showStep(1);
    </script>
</body>
</html>