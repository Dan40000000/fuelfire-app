<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calorie Tracker - FuelFire</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="phone-container">
        <div class="screen">
            <div class="status-bar">
                <span id="time">9:41</span>
                <span>100%</span>
            </div>
            
            <div class="header">
                <div class="hamburger" onclick="toggleSidebar()">‚ò∞</div>
                <div class="header-title">Calorie Tracker</div>
            </div>
            
            <div class="content">
                <div style="padding: 20px;">
                    <!-- Today's Summary -->
                    <div style="background: var(--gradient-1); color: white; padding: 25px; border-radius: 20px; margin-bottom: 25px; text-align: center;">
                        <h2 style="font-size: 18px; margin-bottom: 10px;">üìÖ Today's Progress</h2>
                        <div style="font-size: 48px; font-weight: bold; margin: 10px 0;" id="calories-today">0</div>
                        <div style="font-size: 14px; opacity: 0.9;">calories consumed</div>
                        <div style="margin-top: 20px; background: rgba(255,255,255,0.2); border-radius: 10px; padding: 10px;">
                            <div style="display: flex; justify-content: space-around; font-size: 14px;">
                                <div>
                                    <div style="font-weight: bold;">Target</div>
                                    <div id="calorie-target">2000</div>
                                </div>
                                <div>
                                    <div style="font-weight: bold;">Remaining</div>
                                    <div id="calories-remaining">2000</div>
                                </div>
                                <div>
                                    <div style="font-weight: bold;">% of Goal</div>
                                    <div id="percent-complete">0%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px;">
                        <button onclick="showMealPlanSelector()" style="background: white; border: 2px solid var(--primary); color: var(--primary); padding: 15px; border-radius: 15px; font-weight: bold; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            üçΩÔ∏è Log from Plan
                        </button>
                        <button onclick="showManualEntry()" style="background: white; border: 2px solid var(--primary); color: var(--primary); padding: 15px; border-radius: 15px; font-weight: bold; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            ‚ûï Add Food
                        </button>
                    </div>
                    
                    <!-- Today's Meals -->
                    <div style="background: white; border-radius: 20px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <h3 style="color: var(--primary); margin-bottom: 15px;">üçΩÔ∏è Today's Meals</h3>
                        <div id="today-meals">
                            <p style="text-align: center; color: #999; padding: 20px;">No meals logged yet today</p>
                        </div>
                    </div>
                    
                    <!-- Weekly Summary -->
                    <div style="background: white; border-radius: 20px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <h3 style="color: var(--primary); margin-bottom: 15px;">üìä This Week</h3>
                        <div id="weekly-chart" style="height: 150px; display: flex; align-items: flex-end; justify-content: space-around;">
                            <!-- Weekly bar chart will go here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Overlay for sidebar -->
    <div class="overlay" onclick="toggleSidebar()"></div>
    
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-brand">üî• FuelFire</div>
        </div>
        <div class="sidebar-menu">
            <div class="menu-item" onclick="goToPage('index.html')">üè† Home</div>
            <div class="menu-item" onclick="goToPage('create-workout.html')">üí™ Create Workout</div>
            <div class="menu-item" onclick="goToPage('saved-workouts.html')">üìö Saved Workouts</div>
            <div class="menu-item" onclick="goToPage('track-workouts.html')">üìä Track Workouts</div>
            <div class="menu-item active" onclick="goToPage('calorie-tracker.html')">üî• Calorie Tracker</div>
            <div class="menu-item" onclick="goToPage('enhanced-diet-quiz.html')">üéØ Diet Creation</div>
            <div class="menu-item" onclick="goToPage('meal-plans.html')">üçΩÔ∏è Meal Plans</div>
            <div class="menu-item" onclick="goToPage('progress.html')">üìà Progress & Analytics</div>
            <div class="menu-item">‚öôÔ∏è Settings</div>
        </div>
    </div>
    
    <!-- Manual Entry Modal -->
    <div id="manual-entry-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border-radius: 20px; padding: 30px; width: 90%; max-width: 350px;">
            <h3 style="color: var(--primary); margin-bottom: 20px;">‚ûï Add Food</h3>
            <input type="text" id="food-name" placeholder="Food name" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; margin-bottom: 15px;">
            <input type="number" id="food-calories" placeholder="Calories" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; margin-bottom: 20px;">
            <div style="display: flex; gap: 10px;">
                <button onclick="addManualFood()" style="flex: 1; background: var(--gradient-1); color: white; border: none; padding: 12px; border-radius: 15px; font-weight: bold;">Add</button>
                <button onclick="hideManualEntry()" style="flex: 1; background: #6c757d; color: white; border: none; padding: 12px; border-radius: 15px; font-weight: bold;">Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- Meal Plan Selector Modal -->
    <div id="meal-plan-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border-radius: 20px; padding: 30px; width: 90%; max-width: 400px; max-height: 80vh; overflow-y: auto;">
            <h3 style="color: var(--primary); margin-bottom: 20px;">üçΩÔ∏è Log from Meal Plan</h3>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; font-weight: bold; margin-bottom: 8px;">Select Meal Plan:</label>
                <select id="meal-plan-select" onchange="loadMealPlanMeals()" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; margin-bottom: 15px;">
                    <option value="">Choose a meal plan...</option>
                </select>
            </div>
            
            <div id="meal-plan-meals" style="display: none;">
                <label style="display: block; font-weight: bold; margin-bottom: 8px;">Select Meal:</label>
                <select id="meal-select" onchange="showMealTypeSelector()" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; margin-bottom: 15px;">
                    <option value="">Choose a meal...</option>
                </select>
                
                <div id="meal-type-selector" style="display: none; margin-bottom: 20px;">
                    <label style="display: block; font-weight: bold; margin-bottom: 8px;">Log as:</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <button onclick="logMealFromPlan('breakfast')" style="background: #FF6B6B; color: white; border: none; padding: 10px; border-radius: 10px; font-size: 12px;">üç≥ Breakfast</button>
                        <button onclick="logMealFromPlan('lunch')" style="background: #4ECDC4; color: white; border: none; padding: 10px; border-radius: 10px; font-size: 12px;">ü•ó Lunch</button>
                        <button onclick="logMealFromPlan('dinner')" style="background: #3AA69D; color: white; border: none; padding: 10px; border-radius: 10px; font-size: 12px;">üçΩÔ∏è Dinner</button>
                        <button onclick="logMealFromPlan('snack')" style="background: #F38181; color: white; border: none; padding: 10px; border-radius: 10px; font-size: 12px;">üçé Snack</button>
                    </div>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button onclick="hideMealPlanSelector()" style="flex: 1; background: #6c757d; color: white; border: none; padding: 12px; border-radius: 15px; font-weight: bold;">Cancel</button>
            </div>
        </div>
    </div>
    
    <script>
        function updateTime() {
            const now = new Date();
            const time = now.toLocaleTimeString('en-US', { 
                hour: 'numeric', 
                minute: '2-digit',
                hour12: true 
            });
            document.getElementById('time').textContent = time;
        }
        
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.querySelector('.overlay');
            sidebar.classList.toggle('open');
            overlay.classList.toggle('show');
        }
        
        function goToPage(page) {
            window.location.href = page;
        }
        
        function loadTodaysMeals() {
            const today = new Date().toISOString().split('T')[0];
            const loggedMeals = JSON.parse(localStorage.getItem('fuelfire_logged_meals') || '{}');
            const todayData = loggedMeals[today] || { meals: [], totalCalories: 0 };
            
            // Get user's calorie target (default 2000)
            const userProfile = JSON.parse(localStorage.getItem('fuelfire_user_profile') || '{}');
            const target = userProfile.calorieTarget || 2000;
            
            // Update summary
            document.getElementById('calories-today').textContent = todayData.totalCalories;
            document.getElementById('calorie-target').textContent = target;
            document.getElementById('calories-remaining').textContent = Math.max(0, target - todayData.totalCalories);
            document.getElementById('percent-complete').textContent = Math.round((todayData.totalCalories / target) * 100) + '%';
            
            // Update meals list
            const mealsDiv = document.getElementById('today-meals');
            if (todayData.meals.length === 0) {
                mealsDiv.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">No meals logged yet today</p>';
            } else {
                let mealsHTML = '';
                todayData.meals.forEach((meal, index) => {
                    const time = new Date(meal.time).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
                    mealsHTML += `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f0f0f0;">
                            <div>
                                <div style="font-weight: bold; color: #333;">${meal.type || meal.name}</div>
                                <div style="font-size: 12px; color: #666;">${time} ${meal.fromMealPlan ? '‚Ä¢ From meal plan' : ''}</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="font-weight: bold; color: var(--primary);">${meal.calories} cal</span>
                                <button onclick="removeMeal(${index})" style="background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 8px; font-size: 12px;">√ó</button>
                            </div>
                        </div>
                    `;
                });
                mealsDiv.innerHTML = mealsHTML;
            }
            
            // Load weekly chart
            loadWeeklyChart();
        }
        
        function loadWeeklyChart() {
            const loggedMeals = JSON.parse(localStorage.getItem('fuelfire_logged_meals') || '{}');
            const chartDiv = document.getElementById('weekly-chart');
            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            const today = new Date();
            const dayOfWeek = today.getDay();
            
            let chartHTML = '';
            const maxCalories = 3000; // Max for chart scaling
            
            for (let i = 0; i < 7; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() - dayOfWeek + i + 1); // Start from Monday
                const dateStr = date.toISOString().split('T')[0];
                const dayData = loggedMeals[dateStr] || { totalCalories: 0 };
                const height = (dayData.totalCalories / maxCalories) * 100;
                const isToday = dateStr === today.toISOString().split('T')[0];
                
                chartHTML += `
                    <div style="text-align: center; flex: 1;">
                        <div style="height: 100px; display: flex; align-items: flex-end; justify-content: center;">
                            <div style="width: 30px; height: ${height}%; background: ${isToday ? 'var(--gradient-1)' : '#e0e0e0'}; border-radius: 5px 5px 0 0;"></div>
                        </div>
                        <div style="font-size: 12px; color: #666; margin-top: 5px;">${days[i]}</div>
                        <div style="font-size: 11px; color: #999;">${dayData.totalCalories}</div>
                    </div>
                `;
            }
            
            chartDiv.innerHTML = chartHTML;
        }
        
        function removeMeal(index) {
            if (confirm('Remove this meal?')) {
                const today = new Date().toISOString().split('T')[0];
                const loggedMeals = JSON.parse(localStorage.getItem('fuelfire_logged_meals') || '{}');
                
                if (loggedMeals[today] && loggedMeals[today].meals[index]) {
                    const removedCalories = loggedMeals[today].meals[index].calories;
                    loggedMeals[today].meals.splice(index, 1);
                    loggedMeals[today].totalCalories -= removedCalories;
                    
                    localStorage.setItem('fuelfire_logged_meals', JSON.stringify(loggedMeals));
                    loadTodaysMeals();
                }
            }
        }
        
        function showManualEntry() {
            document.getElementById('manual-entry-modal').style.display = 'block';
            document.getElementById('food-name').focus();
        }
        
        function hideManualEntry() {
            document.getElementById('manual-entry-modal').style.display = 'none';
            document.getElementById('food-name').value = '';
            document.getElementById('food-calories').value = '';
        }
        
        function addManualFood() {
            const name = document.getElementById('food-name').value;
            const calories = parseInt(document.getElementById('food-calories').value);
            
            if (!name || !calories) {
                alert('Please enter both food name and calories');
                return;
            }
            
            const today = new Date().toISOString().split('T')[0];
            let loggedMeals = JSON.parse(localStorage.getItem('fuelfire_logged_meals') || '{}');
            
            if (!loggedMeals[today]) {
                loggedMeals[today] = { meals: [], totalCalories: 0 };
            }
            
            loggedMeals[today].meals.push({
                name: name,
                calories: calories,
                time: new Date().toISOString(),
                fromMealPlan: false
            });
            
            loggedMeals[today].totalCalories += calories;
            localStorage.setItem('fuelfire_logged_meals', JSON.stringify(loggedMeals));
            
            hideManualEntry();
            loadTodaysMeals();
        }
        
        // Meal Plan Selector Functions
        let selectedMealData = null;
        
        function showMealPlanSelector() {
            // Load saved meal plans
            const savedPlans = JSON.parse(localStorage.getItem('fuelfire_saved_meal_plans') || '[]');
            const selectElement = document.getElementById('meal-plan-select');
            
            // Clear existing options
            selectElement.innerHTML = '<option value="">Choose a meal plan...</option>';
            
            if (savedPlans.length === 0) {
                selectElement.innerHTML += '<option value="">No saved meal plans found</option>';
                alert('No saved meal plans found!\n\nPlease save a meal plan first by:\n1. Going to Meal Plans\n2. Generating a meal plan\n3. Clicking "üíæ Save Plan"');
                return;
            }
            
            // Add meal plan options
            savedPlans.forEach(plan => {
                selectElement.innerHTML += `<option value="${plan.id}">${plan.name} (${plan.createdAt})</option>`;
            });
            
            document.getElementById('meal-plan-modal').style.display = 'block';
        }
        
        function hideMealPlanSelector() {
            document.getElementById('meal-plan-modal').style.display = 'none';
            document.getElementById('meal-plan-meals').style.display = 'none';
            document.getElementById('meal-type-selector').style.display = 'none';
            selectedMealData = null;
        }
        
        function loadMealPlanMeals() {
            const planId = document.getElementById('meal-plan-select').value;
            if (!planId) {
                document.getElementById('meal-plan-meals').style.display = 'none';
                return;
            }
            
            const savedPlans = JSON.parse(localStorage.getItem('fuelfire_saved_meal_plans') || '[]');
            const selectedPlan = savedPlans.find(plan => plan.id === planId);
            
            if (!selectedPlan || !selectedPlan.meals) {
                alert('No meals found in this plan');
                return;
            }
            
            const mealSelect = document.getElementById('meal-select');
            mealSelect.innerHTML = '<option value="">Choose a meal...</option>';
            
            // Group meals by day and type
            const groupedMeals = {};
            selectedPlan.meals.forEach((meal, index) => {
                const dayKey = `Day ${meal.day}`;
                if (!groupedMeals[dayKey]) groupedMeals[dayKey] = {};
                if (!groupedMeals[dayKey][meal.type]) groupedMeals[dayKey][meal.type] = [];
                groupedMeals[dayKey][meal.type].push({...meal, index});
            });
            
            // Add organized options
            Object.keys(groupedMeals).sort((a, b) => {
                const dayA = parseInt(a.replace('Day ', ''));
                const dayB = parseInt(b.replace('Day ', ''));
                return dayA - dayB;
            }).forEach(day => {
                const dayMeals = groupedMeals[day];
                ['breakfast', 'lunch', 'dinner', 'snacks'].forEach(mealType => {
                    if (dayMeals[mealType]) {
                        dayMeals[mealType].forEach(meal => {
                            mealSelect.innerHTML += `<option value="${meal.index}">${day} - ${meal.type.charAt(0).toUpperCase() + meal.type.slice(1)}: ${meal.name}</option>`;
                        });
                    }
                });
            });
            
            document.getElementById('meal-plan-meals').style.display = 'block';
        }
        
        function showMealTypeSelector() {
            const mealIndex = document.getElementById('meal-select').value;
            if (!mealIndex) {
                document.getElementById('meal-type-selector').style.display = 'none';
                return;
            }
            
            const planId = document.getElementById('meal-plan-select').value;
            const savedPlans = JSON.parse(localStorage.getItem('fuelfire_saved_meal_plans') || '[]');
            const selectedPlan = savedPlans.find(plan => plan.id === planId);
            
            selectedMealData = selectedPlan.meals[parseInt(mealIndex)];
            document.getElementById('meal-type-selector').style.display = 'block';
        }
        
        function logMealFromPlan(logAsType) {
            if (!selectedMealData) {
                alert('Please select a meal first');
                return;
            }
            
            const today = new Date().toISOString().split('T')[0];
            let loggedMeals = JSON.parse(localStorage.getItem('fuelfire_logged_meals') || '{}');
            
            if (!loggedMeals[today]) {
                loggedMeals[today] = { meals: [], totalCalories: 0 };
            }
            
            const logEntry = {
                name: selectedMealData.name,
                type: logAsType,
                calories: selectedMealData.calories,
                protein: selectedMealData.protein,
                carbs: selectedMealData.carbs,
                fat: selectedMealData.fat,
                time: new Date().toISOString(),
                fromMealPlan: true,
                originalDay: selectedMealData.day,
                originalType: selectedMealData.type
            };
            
            loggedMeals[today].meals.push(logEntry);
            loggedMeals[today].totalCalories += selectedMealData.calories;
            
            localStorage.setItem('fuelfire_logged_meals', JSON.stringify(loggedMeals));
            
            alert(`‚úÖ ${selectedMealData.name} logged as ${logAsType}!\n\nüìä ${selectedMealData.calories} calories\nü•© ${selectedMealData.protein}g protein\nüçû ${selectedMealData.carbs}g carbs\nü•ë ${selectedMealData.fat}g fat`);
            
            hideMealPlanSelector();
            loadTodaysMeals();
        }
        
        // Initialize
        window.addEventListener('load', function() {
            updateTime();
            setInterval(updateTime, 1000);
            loadTodaysMeals();
        });
    </script>
</body>
</html>